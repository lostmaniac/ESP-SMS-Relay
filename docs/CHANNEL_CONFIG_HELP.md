# æ¨é€æ¸ é“é…ç½®å¸®åŠ©ç³»ç»Ÿ

## æ¦‚è¿°

æœ¬æ–‡æ¡£ä»‹ç»äº†ESP-SMS-Relayé¡¹ç›®ä¸­æ–°å¢çš„æ¨é€æ¸ é“é…ç½®å¸®åŠ©ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿä¸ºç”¨æˆ·æä¾›äº†è¯¦ç»†çš„æ¸ é“é…ç½®æŒ‡å¯¼ã€‚

## åŠŸèƒ½ç‰¹æ€§

### 1. å¢å¼ºçš„å¸®åŠ©å‘½ä»¤

- **é€šç”¨å¸®åŠ©**: `help` æˆ– `h` - æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤å’Œå¿«é€Ÿé…ç½®ç¤ºä¾‹
- **æ¸ é“ç‰¹å®šå¸®åŠ©**: `help <æ¸ é“å>` - æ˜¾ç¤ºç‰¹å®šæ¨é€æ¸ é“çš„è¯¦ç»†é…ç½®è¯´æ˜

### 2. æ”¯æŒçš„æ¸ é“

- **ä¼ä¸šå¾®ä¿¡** (`wechat`)
- **é’‰é’‰** (`dingtalk`) 
- **è‡ªå®šä¹‰Webhook** (`webhook`)

## ä½¿ç”¨æ–¹æ³•

### æŸ¥çœ‹æ‰€æœ‰å¸®åŠ©ä¿¡æ¯

```
sms-relay> help
```

æ˜¾ç¤ºå†…å®¹åŒ…æ‹¬ï¼š
- æ‰€æœ‰å¯ç”¨å‘½ä»¤åˆ—è¡¨
- å¯ç”¨æ¨é€æ¸ é“æ¦‚è§ˆ
- å¿«é€Ÿé…ç½®ç¤ºä¾‹
- è¯¦ç»†å¸®åŠ©æç¤º

### æŸ¥çœ‹ç‰¹å®šæ¸ é“é…ç½®

#### ä¼ä¸šå¾®ä¿¡é…ç½®å¸®åŠ©
```
sms-relay> help wechat
```

#### é’‰é’‰é…ç½®å¸®åŠ©
```
sms-relay> help dingtalk
```

#### Webhooké…ç½®å¸®åŠ©
```
sms-relay> help webhook
```

## é…ç½®å­—æ®µè¯¦è§£

### ä¼ä¸šå¾®ä¿¡ (wechat)

**å¿…å¡«å­—æ®µï¼š**
- `webhook_url`: ä¼ä¸šå¾®ä¿¡æœºå™¨äººWebhookåœ°å€

**å¯é€‰å­—æ®µï¼š**
- `msg_type`: æ¶ˆæ¯ç±»å‹ (text/markdownï¼Œé»˜è®¤text)
- `mentioned_list`: @æŒ‡å®šç”¨æˆ·ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”
- `mentioned_mobile_list`: @æŒ‡å®šæ‰‹æœºå·ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”
- `template`: æ¶ˆæ¯æ¨¡æ¿ï¼Œæ”¯æŒå ä½ç¬¦

**é…ç½®ç¤ºä¾‹ï¼š**
```json
{
  "webhook_url": "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY",
  "template": "ğŸ“± æ”¶åˆ°æ–°çŸ­ä¿¡\n\nğŸ“ å‘é€æ–¹: {sender}\nğŸ• æ—¶é—´: {timestamp}\nğŸ“„ å†…å®¹: {content}",
  "msg_type": "text"
}
```

### é’‰é’‰ (dingtalk)

**å¿…å¡«å­—æ®µï¼š**
- `webhook_url`: é’‰é’‰æœºå™¨äººWebhookåœ°å€

**å¯é€‰å­—æ®µï¼š**
- `secret`: é’‰é’‰æœºå™¨äººå¯†é’¥ï¼Œç”¨äºç­¾åéªŒè¯
- `template`: æ¶ˆæ¯æ¨¡æ¿ï¼Œæ”¯æŒå ä½ç¬¦
- `msg_type`: æ¶ˆæ¯ç±»å‹ (text/markdownï¼Œé»˜è®¤text)

**é…ç½®ç¤ºä¾‹ï¼š**
```json
{
  "webhook_url": "https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN",
  "secret": "YOUR_SECRET",
  "template": "ğŸ“± æ”¶åˆ°æ–°çŸ­ä¿¡\n\nğŸ“ å‘é€æ–¹: {sender}\nğŸ• æ—¶é—´: {timestamp}\nğŸ“„ å†…å®¹: {content}",
  "msg_type": "text"
}
```

### è‡ªå®šä¹‰Webhook (webhook)

**å¿…å¡«å­—æ®µï¼š**
- `webhook_url`: ç›®æ ‡URLåœ°å€

**å¯é€‰å­—æ®µï¼š**
- `method`: HTTPæ–¹æ³• (GET/POST/PUTï¼Œé»˜è®¤POST)
- `content_type`: å†…å®¹ç±»å‹ (é»˜è®¤application/json)
- `headers`: è‡ªå®šä¹‰HTTPå¤´éƒ¨ï¼Œæ ¼å¼ä¸ºkey1:value1,key2:value2
- `body_template`: æ¶ˆæ¯ä½“æ¨¡æ¿ï¼Œæ”¯æŒå ä½ç¬¦

**é…ç½®ç¤ºä¾‹ï¼š**
```json
{
  "webhook_url": "https://api.example.com/webhook",
  "method": "POST",
  "content_type": "application/json",
  "headers": "Authorization:Bearer YOUR_TOKEN,Content-Type:application/json",
  "body_template": "{\"message\":\"{content}\",\"from\":\"{sender}\",\"time\":\"{timestamp}\"}"
}
```

## å ä½ç¬¦è¯´æ˜

æ‰€æœ‰æ¸ é“çš„æ¨¡æ¿éƒ½æ”¯æŒä»¥ä¸‹å ä½ç¬¦ï¼š

- `{sender}`: çŸ­ä¿¡å‘é€æ–¹å·ç 
- `{content}`: çŸ­ä¿¡å†…å®¹
- `{timestamp}`: æ¥æ”¶æ—¶é—´æˆ³
- `{sms_id}`: çŸ­ä¿¡è®°å½•ID

## å®Œæ•´æ·»åŠ è§„åˆ™ç¤ºä¾‹

### ä¼ä¸šå¾®ä¿¡è§„åˆ™
```
add "é“¶è¡Œæé†’" "95588" "wechat" "{\"webhook_url\":\"https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY\"}" "ä½™é¢" false
```

### é’‰é’‰è§„åˆ™
```
add "é’‰é’‰é€šçŸ¥" "10086" "dingtalk" "{\"webhook_url\":\"https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN\"}" "æµé‡" false
```

### Webhookè§„åˆ™
```
add "è‡ªå®šä¹‰æ¨é€" "*" "webhook" "{\"webhook_url\":\"https://api.example.com/webhook\",\"method\":\"POST\"}" "" false
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ¨é€å¤±è´¥**
   - æ£€æŸ¥webhook_urlå’Œå¯†é’¥æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
   - éªŒè¯JSONæ ¼å¼æ˜¯å¦æ­£ç¡®

2. **é…ç½®æ ¼å¼é”™è¯¯**
   - ç¡®ä¿JSONæ ¼å¼æ­£ç¡®ï¼Œæ³¨æ„å¼•å·å’Œé€—å·
   - ä½¿ç”¨è½¬ä¹‰å­—ç¬¦å¤„ç†ç‰¹æ®Šå­—ç¬¦
   - æ£€æŸ¥å¿…å¡«å­—æ®µæ˜¯å¦å®Œæ•´

3. **æƒé™é—®é¢˜**
   - ç¡®ä¿æœºå™¨äººå·²æ·»åŠ åˆ°ç›®æ ‡ç¾¤èŠ
   - æ£€æŸ¥æœºå™¨äººæƒé™è®¾ç½®
   - éªŒè¯è®¿é—®ä»¤ç‰Œæœ‰æ•ˆæ€§

### è°ƒè¯•æŠ€å·§

1. ä½¿ç”¨ `test` å‘½ä»¤æµ‹è¯•è§„åˆ™åŒ¹é…
2. æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€äº†è§£é”™è¯¯ä¿¡æ¯
3. é€æ­¥ç®€åŒ–é…ç½®æ’æŸ¥é—®é¢˜

## æŠ€æœ¯å®ç°

### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TerminalManagerâ”‚    â”‚   PushManager   â”‚    â”‚ PushChannelBase â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ - executeHelp() â”‚â”€â”€â”€â–¶â”‚ getAllChannel() â”‚â”€â”€â”€â–¶â”‚   getHelp()     â”‚
â”‚ - showChannel() â”‚    â”‚ getAllExamples()â”‚    â”‚ getExample()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

1. **TerminalManager**: å¤„ç†CLIå‘½ä»¤å’Œå¸®åŠ©æ˜¾ç¤º
2. **PushManager**: ç®¡ç†æ¨é€æ¸ é“ï¼Œæä¾›ç»Ÿä¸€æ¥å£
3. **PushChannelBase**: å„æ¸ é“çš„åŸºç±»ï¼Œæä¾›å¸®åŠ©ä¿¡æ¯æ¥å£

### æ•°æ®ç»“æ„

```cpp
struct PushChannelHelp {
    String channelName;      // æ¸ é“åç§°
    String description;      // æ¸ é“æè¿°
    String configFields;     // é…ç½®å­—æ®µè¯´æ˜
    String ruleExample;      // è§„åˆ™ç¤ºä¾‹
    String troubleshooting;  // æ•…éšœæ’é™¤ä¿¡æ¯
};

struct PushChannelExample {
    String channelName;      // æ¸ é“åç§°
    String description;      // æ¸ é“æè¿°
    String configExample;    // é…ç½®ç¤ºä¾‹
    String usage;           // ä½¿ç”¨è¯´æ˜
    String helpText;        // å¸®åŠ©æ–‡æœ¬
};
```

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01-XX)
- æ–°å¢æ¸ é“ç‰¹å®šå¸®åŠ©å‘½ä»¤
- å®ç°è¯¦ç»†é…ç½®å­—æ®µè¯´æ˜
- æ·»åŠ å®Œæ•´çš„é…ç½®ç¤ºä¾‹
- æä¾›æ•…éšœæ’é™¤æŒ‡å¯¼
- æ”¯æŒå¿«é€Ÿæ·»åŠ å‘½ä»¤æ¨¡æ¿

---

**æ³¨æ„**: åœ¨ä½¿ç”¨é…ç½®ç¤ºä¾‹æ—¶ï¼Œè¯·å°† `YOUR_KEY`ã€`YOUR_TOKEN`ã€`YOUR_SECRET` ç­‰å ä½ç¬¦æ›¿æ¢ä¸ºå®é™…çš„å¯†é’¥å’Œä»¤ç‰Œã€‚